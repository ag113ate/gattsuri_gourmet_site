<div id="tamesi_area">
  <% @stores.each do |store| %>
    <div class="store-area" class="clearfix">
      <div class="store-top-area clearfix">
        <div class="store-name-area">
          <%= store.name %> <br>
          <ul>
          <%  for loop in 1..5 do                                        %>
          <li>
          <%    if (loop <= store.review)                                %>
          <%=     image_tag("meat_color_all.png", class: "review-icon")  %>
          <%    elsif ((loop - 0.5) <= store.review)                     %>
          <%=     image_tag("meat_color_half.png", class: "review-icon") %>
          <%    else                                                     %>
          <%=     image_tag("meat_color_none.png", class: "review-icon") %>
          <%    end                                                      %>
          </li>
          <%  end                                                        %>
          
          <li class="review-point_area"><%= store.review %></li>
          </ul>
        </div>
        <div id="bookmark-area">
          <%= link_to "お気に入り追加", "#", class:"btn" %>
          <br>
          ジャンル：<%= store.category_name_l %> <br>
        </div>
      </div>
      
      <div class="store-content-area clearfix">
        <% store.food_images.each do |image| %>
          <div class="store-image-area">
            <%= image_tag("store_img/#{image.image_url}", class: "img-param") %>
          </div>
        <% end %>
        <div class="store-info-area">
          <table>
            <tr>
              <th>住所</th>
              <td><%= simple_format(store.address) %></td>
            </tr>
            
            <tr>
              <th>アクセス</th>
              <% access = "#{store.line} #{store.station} #{store.station_exit} \
              徒歩#{store.walk}分" %>
              
              <td><%= simple_format(access) %></td>
            </tr>
            
            <tr>
              <th>電話番号</th>
              <td><%= simple_format(store.tel) %></td>
            </tr>
            
            <tr>
              <th>営業時間</th>
              <td><%= simple_format(store.opentime) %></td>
            </tr>
            
            <tr>
              <th>定休日</th>
              <td><%= simple_format(store.holiday) %></td>
            </tr>
          </table>
        </div> <!-- store-info-area -->
      </div> <!-- store-content-area -->
      
      <div class="store-bottom-area clearfix">
        <ul>
          <li><%= link_to "コメントを見る"  , "#", class: "btn" %></li>
          <li><%= link_to "コメントを書く"  , "#", class: "btn" %></li>
          <li><%= link_to "ぐるなびページへ", store.shop_url, \
                                 class: "btn", target: "_blank" %></li>
        </ul>
      </div> <!-- store-bottom-area -->
    </div> <!-- store-area -->
  <% end %> <%# @stores.each %>
</div> <!-- tamesi_area -->

<div id="map_area">
  
  <%# <%= image_tag("google_map_yelp_site.jpg") %>
</div>

<script type="text/javascript">
  handler = Gmaps.build('Google');
  handler.buildMap({provider: {mapTypeControl: false}, internal: {id:'map_area'}}, function(){
    markers = handler.addMarkers(<%= raw @hash.to_json %>);
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
    
    $.each(markers, function(index, marker){
      google.maps.event.addListener(marker.getServiceObject(), "mouseover", function(){
        this.setIcon('/assets/steak.png');
      });
      
      google.maps.event.addListener(marker.getServiceObject(), "mouseout", function(){
        this.setIcon('/assets/raw_meat.png');
      });
      
      google.maps.event.addListener(marker.getServiceObject(), "click", function(){
        var target = $('.store-area').eq(index);
        
        var position = target.offset().top - 50;
        
        $("body,html").animate({scrollTop:position}, 400, "swing");
      });
    })
  });

  $('.store-area').mouseover(function(){
    var index = $('.store-area').index(this);
    var marker = markers[index];
    
    marker.getServiceObject().setIcon('/assets/steak.png');
    
    $(this).css("background", "orange");
  });
  
  $('.store-area').mouseout(function(){
    var index = $('.store-area').index(this);
    var marker = markers[index];
    
    marker.getServiceObject().setIcon('/assets/raw_meat.png');
    
    $(this).css("background", "rgb(91, 155, 213)");
  });
  
</script>

